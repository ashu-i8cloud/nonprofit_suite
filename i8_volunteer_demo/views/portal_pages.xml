<odoo>
    <!-- /v/chapters -->
    <template id="page_chapters">
        <t t-call="website.layout">
            <div class="container my-4">
                <div class="mb-3">
                    <a href="/my" class="btn btn-light"
                       onclick="if (history.length > 1) { history.back(); return false; }">← Back
                    </a>
                </div>
                <h3 class="mb-3">Select Chapter</h3>
                <div class="row g-3">
                    <t t-foreach="companies" t-as="c">
                        <div class="col-12 col-md-6 col-lg-4">
                            <div class="card h-100 shadow-sm">
                                <img t-att-src="'/web/image?model=res.company&amp;id=%s&amp;field=logo' % c.id"
                                     class="card-img-top" t-att-alt="c.name" style="object-fit:cover; height:160px;"/>
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">
                                        <t t-esc="c.name"/>
                                    </h5>
                                    <p class="card-text text-muted">
                                        <t t-esc="c.city or ''"/>
                                        <t t-if="c.city and c.country_id">,</t>
                                        <t t-esc="c.country_id.name or ''"/>
                                    </p>
                                    <a t-att-href="'/v/events?chapter=%s' % c.id"
                                       class="btn btn-primary mt-auto">View Events
                                    </a>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- /v/events?chapter=ID -->
    <template id="page_events">
        <t t-call="website.layout">
            <div class="container my-4">
                <div class="mb-3">
                    <a href="/v/chapters" class="btn btn-light"
                       onclick="if (history.length > 1) { history.back(); return false; }">← Back
                    </a>
                </div>
                <h3 class="mb-3">Events</h3>

                <t t-if="cards">
                    <div class="row g-3">
                        <t t-foreach="cards" t-as="c">
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="card h-100 shadow-sm">
                                    <img t-att-src="c['img_url']"
                                         class="card-img-top o_we_no_overlay"
                                         t-att-alt="c['name']"
                                         style="object-fit:cover; height:180px; background:#f8f9fa;"/>

                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title mb-1"><t t-esc="c['name']"/></h5>
                                        <div class="text-primary-emphasis mb-2" style="font-size:0.9rem;">
                                          <t t-esc="c['date_begin']"/> → <t t-esc="c['date_end']"/>
                                        </div>
                                        <p class="card-text text-muted" style="min-height:3rem;">
                                          <t t-esc="c['short_desc']"/>
                                        </p>
                                        <a t-att-href="'/v/event/%s' % c['id']" class="btn btn-primary mt-auto">
                                          View &amp; Volunteer
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </t>
                <t t-else="">
                    <div class="alert alert-info">No events found for this chapter.</div>
                </t>
            </div>
        </t>
    </template>

    <!-- /v/event/<id> -->
    <template id="page_event_detail">
        <t t-call="website.layout">
            <div class="container my-4 i8-volunteer-page">
                <t t-if="event">
                    <div class="mb-3">
                        <a t-att-href="'/v/events?chapter=%s' % (event.company_id.id or 0)"
                           class="btn btn-light"
                           onclick="if (history.length > 1) { history.back(); return false; }">← Back
                        </a>
                    </div>
                    <h3>
                        <t t-esc="event.name"/>
                    </h3>
                    <t t-if="activities">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Activity</th>
                                    <th>Time</th>
                                    <th>Cap</th>
                                    <th>Status</th>
                                    <th/>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="activities" t-as="a">
                                    <tr>
                                        <td>
                                            <t t-esc="a.name"/>
                                        </td>
                                        <td>
                                            <t t-esc="a.start"/>
                                            –
                                            <t t-esc="a.end"/>
                                        </td>
                                        <td>
                                            <t t-esc="a.capacity or '—'"/>
                                        </td>
                                        <td>
                                            <t t-set="mine" t-value="my_shift_by_activity.get(a.id)"/>
                                            <t t-if="mine is not None">
                                                <span t-att-class="'badge ' + ('bg-success' if mine.state in ['confirmed','checkin','checkout'] else ('bg-warning' if mine.state=='pending' else 'bg-secondary'))">
                                                    <t t-esc="mine.state.title()"/>
                                                </span>
                                            </t>
                                            <t t-else="">
                                                <span class="text-muted">Not signed</span>
                                            </t>
                                        </td>
                                        <td>
                                            <t t-if="not mine and a.allow_self_signup">
                                                <button type="button" t-attf-data-id="{{ a.id }}"
                                                        class="btn btn-primary btn-sm i8-signup">Sign up
                                                </button>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </t>
                    <t t-if="my_shifts">
                        <h5>My Shifts</h5>
                        <ul class="list-unstyled">
                            <t t-foreach="my_shifts" t-as="s">
                                <li class="my-1">
                                    <t t-esc="s.activity_id.name"/>
                                    —
                                    <t t-esc="s.state.title()"/>
                                    <t t-if="s.state == 'confirmed'">
                                        <button t-attf-data-id="{{ s.id }}"
                                                class="btn btn-outline-primary btn-sm i8-checkin">Check-in
                                        </button>
                                    </t>
                                    <t t-if="s.state == 'checkin'">
                                        <button t-attf-data-id="{{ s.id }}" class="btn btn-primary btn-sm i8-checkout">
                                            Check-out
                                        </button>
                                    </t>
                                    <t t-if="s.state == 'checkout'">
                                        <button t-attf-data-id="{{ s.id }}" class="btn btn-primary btn-sm i8-checkout"
                                                style="display:none;"></button>
                                        <t t-if="s.certificate_attachment_id">
                                            <a t-att-href="'/web/content/%s?download=1&amp;access_token=%s' % (s.certificate_attachment_id.id, s.certificate_attachment_id.access_token)"
                                               class="btn btn-outline-secondary btn-sm">
                                                Download Certificate
                                            </a>
                                        </t>
                                    </t>
                                </li>
                            </t>
                        </ul>
                    </t>
                </t>
            </div>
        </t>
    </template>
</odoo>
